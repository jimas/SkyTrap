<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-spring4-3.dtd">
<html lang="zh-CN" class="no-js" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head>
<title>task list</title>
<meta name="full-screen" content="yes">
<meta name="x5-fullscreen" content="true">
<div th:include="common/drop/dropcss :: dropcss" th:remove="tag" />

<style type="text/css">
th {
	text-align: center;
}
</style>
</head>
<body th:with="headTitle='城市列表'">
	<div th:replace="common/header :: header" th:remove="tag" />
	<div class="content">
		<table class="table table-hover table-bordered">
			<thead>
				<tr>
					<th>id</th>
					<th>cname</th>
					<th>upid</th>
				</tr>
			</thead>
			<tbody class="citylist">
			</tbody>
		</table>
	</div>

	<div th:include="common/drop/dropjs :: dropjs" th:remove="tag" />

	<script th:inline="javascript">
	var basePath=[[@{/}]];
	$(function() {
		// 页数
		var page = 0;
		// 每页展示10个
		var size = 10;
	$('.content').dropload({
	    scrollArea : window,
	    loadUpFn : function(me){
	        $.ajax({
	            type: 'GET',
	            url: basePath+'city/findCitys?pageNumber='
					+ 1
					+ '&limit='
					+ size,
	            dataType: 'json',
	            success: function(data){
	           	 var result = '';
				 var arrLen = data.result.length;
					if (arrLen > 0) {
						for (var i = 0; i < arrLen; i++) {
							result+="<tr>"
							  +"<td>"+data.result[i].id+"</td>"
							 +"<td>"+data.result[i].cname+"</td>"
							 +"<td>"+data.result[i].upid+"</td>"
							 +"</tr>";
						}
					}
				 $('.citylist').html(result);
	             // 每次数据加载完，必须重置
				 me.resetload();
                 // 重置页数，重新获取loadDownFn的数据
                 page = 1;
                 // 解锁loadDownFn里锁定的情况
                 me.unlock();
                 me.noData(false);
	            },
	            error: function(xhr, type){
	                alert('Ajax error!');
	                // 即使加载出错，也得重置
	                me.resetload();
	            }
	        });
	    },
	    loadDownFn : function(me) {
	    	page++;
			// 拼接HTML
			var result = '';
			$.ajax({
				type : 'GET',
				url : basePath+'city/findCitys?pageNumber='
						+ page
						+ '&limit='
						+ size,

				dataType : 'json',
				success : function(data) {
					var arrLen = data.result.length;
					if (arrLen > 0) {
						for (var i = 0; i < arrLen; i++) {
							console.log(data.result[i]);
							result+="<tr>"
							  +"<td>"+data.result[i].id+"</td>"
							 +"<td>"+data.result[i].cname+"</td>"
							 +"<td>"+data.result[i].upid+"</td>"
							 +"</tr>";
						}
						// 如果没有数据
					} else {
						// 锁定
						me.lock();
						// 无数据
						me.noData();
					}
					// 插入数据到页面，放到最后面
					$('.citylist').append(result);
					// 每次数据插入，必须重置
					me.resetload();
				},
				error : function(xhr, type) {
					alert('Ajax error!');
					// 即使加载出错，也得重置
					me.resetload();
				}
			});
	    }
	});
	});
	</script>

</body>

</html>